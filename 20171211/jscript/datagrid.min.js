(function($){var C=function(g,h){var i=$('<div></div>');var j=$('<div></div>');var l=$('<div></div>');var m=$('<div></div>');var n=$('<div></div>');var o=$('<div></div>');g.css('width',h.width+"px");if(h.title){i.addClass('mDiv');i.html(h.title);g.append(i)};if(h.searchitems){n.addClass('sDiv');var p=$('<form></form>');$.each(h.searchitems,function(k,v){var a=$("<div></div>");a.addClass("pGroup");var b=$('<span class="label"></span>');b.append(v.display+":");a.append(b);if(v.type){var c=$("<input type='"+v.type+"' name='"+v.name+"'>");if(v.width){c.css('width',v.width)};a.append(c);if(v.value){c.val(v.value)}}else{a.append(v.html)};p.append(a)});n.append(p);n.append("<div class='pGroup'><a type='button' class='button'>"+"<span class='button_span'><span class='pSearch'>查询</span>"+"</span></a></div>");if(h.exporturl){n.append("<div class='pGroup'><a type='button' class='button'>"+"<span class='button_span'><span>导出Excel</span></span></a></div>")};$('.pGroup a.button:first',n).click(function(){var a=$(g).data('sgDatagrid');var b={};b=a.query;var c=$("form",n).serializeArray();$.each(c,function(k,v){if(v.value!=null&&v.value.trim().length>0&&v.value!='null')b[v.name]=v.value;else b[v.name]=null});h.query=b;E(g,h)});if($('.pGroup a.button',n).length>1){$('.pGroup a.button:last',n).click(function(){var a=$("form",n).serializeArray();var b=[];$.each(a,function(k,v){if(v.value!=null&&v.value.trim().length>0&&v.value!='null'){b.push(v.name+"="+v.value)}});var c=$(g).data('sgDatagrid');var d=c.query;for(var e in d){b.push(e+"="+d[e])};var f=h.exporturl+"?"+b.join('&');window.location.href=f})};g.append(n)};if(h.buttons){m.addClass('tDiv');$.each(h.buttons,function(k,v){if(!v.separator){var a=$('<div></div>');a.addClass("fbutton");var b=$('<span></span>');b.addClass(v.bclass);b.html(v.name);a.on('click',function(){(v.onpress)(this)});a.append(b);m.append(a)}else{m.append("<div class='btnseparator'></div>")}});g.append(m)};if(h.colModel){j.addClass('hDiv');var q=$('<table></table>');q.attr('cellpadding',0);q.attr('cellspacing',0);var r=$('<thead></thead>');var s=$('<tr></tr>');if(h.colid){var t=$('<th axis="checkbox"></th>');var u=$('<input type="checkbox" name="checkall" style="margin-top:8px;" />');if(!h.isNotCheckall){t.append(u)}else{t.attr('width','13px')};u.change(function(){if(!u.attr("checked")){u.attr("checked",true);$('input[type=checkbox]',l).prop("checked",true);$('input[type=checkbox]',l).attr("checked","checked")}else if(u.attr("checked")){u.removeAttr("checked");$('input[type=checkbox]',l).prop("checked",null);$('input[type=checkbox]',l).removeAttr("checked")}});s.append(t)};if(h.rownumbers){var w=$('<th axis="rownumbers">序号</th>');w.width(34);s.append(w)};$.each(h.colModel,function(k,v){var a=$('<th></th>');a.attr('axis',v.name);a.width(v.width);var b=$('<div></div>');if(v.sortable){a.addClass('sorted');b.attr('axis',v.name);if(v.name==h.sortname){if(h.sortname=='desc'){b.attr('title','降序');b.attr('sort','desc')}else{b.attr('title','升序');b.attr('sort','asc')};b.addClass('s'+h.sortorder);b.addClass('thOver')};b.hover(function(){if(!$(this).attr('class')){$(this).addClass('sdesc')}},function(){if($(this).attr('class').indexOf('thOver')>=0){}else{$(this).removeClass()}});b.click(function(){if($(this).attr('class').indexOf('thOver')>=0){if($(this).attr('class')=='sdesc thOver'){$(this).removeClass();$(this).attr('title','升序');$(this).attr('sort','asc');$(this).addClass('sasc thOver')}else{$(this).removeClass();$(this).attr('title','降序');$(this).attr('sort','desc');$(this).addClass('sdesc thOver')}}else{$('.sorted .thOver',j).each(function(){$(this).removeClass();$(this).removeAttr('title')});$(this).attr('title','降序');$(this).attr('sort','desc');$(this).addClass('thOver')};K(g,h,$(this))})};if(v.editable){a.attr('editable',v.editable)};if(v.disabled){a.attr('disabled',v.disabled)};if(v.isnum){a.attr('isnum',v.isnum)};if(v.isrequest){a.attr('isrequest',v.isrequest)};if(v.html){a.attr('ishtml',true)};b.append(v.display);a.append(b);s.append(a)});r.append(s);q.append(r);j.append(q);g.append(j)};l.addClass('bDiv');l.css('height',h.height+'px');var x=$('<table></table>');x.attr('id',g.attr("id")+"_tbl");x.attr('cellpadding',0);x.attr('cellspacing',0);x.attr('border',0);l.append(x);g.append(l);if(h.usepager){o.addClass('pDiv');var y=Math.ceil(h.total/h.rp);if(h.useRp){var z=$('<div></div>');z.addClass('pGroup');var A=$('<select></select>');A.attr('id',g.attr("id")+'_rp');A.attr('name','rp');$.each(h.rpOptions,function(k,v){var a=$('<option></option>');if(h.rp==v){a.attr('selected','selected')};a.attr('value',v);a.html(v+'&nbsp;&nbsp;');A.append(a)});z.append(A);o.append(z);o.append("<div class='btnseparator'></div>");$('select',o).change(function(){h.rp=+this.value;E(g,h)})};var B=$('<div class="pGroup"><div class="pFirst button"></div><div class="pPrev button"></div></div><div class="btnseparator"></div>'+'<div class="pGroup"><span class="pControl">第<input type="text" size="4" value="'+h.page+'">页&nbsp;&nbsp;共<span>'+y+'</span>页</span></div><div class="btnseparator"></div>'+'<div class="pGroup"><div class="pNext button"></div><div class="pLast button"></div></div><div class="btnseparator"></div>'+'<div class="pGroup"><div class="pReload button"></div></div><div class="btnseparator"></div><div class="pGroup"><span class="pPageStat"></span></div>');o.append(B);$('.pReload',o).click(function(){$('input[type=checkbox]',j).removeAttr("checked");E(g,h)});$('.pFirst',o).click(function(){$('input[type=checkbox]',j).removeAttr("checked");J('first',g,h)});$('.pPrev',o).click(function(){$('input[type=checkbox]',j).removeAttr("checked");J('prev',g,h)});$('.pNext',o).click(function(){$('input[type=checkbox]',j).removeAttr("checked");J('next',g,h)});$('.pLast',o).click(function(){$('input[type=checkbox]',j).removeAttr("checked");J('last',g,h)});$('.pControl input',o).keydown(function(e){$('input[type=checkbox]',j).removeAttr("checked");if(e.keyCode==13){J('input',g,h)}});g.append(o)};E(g,h)};var D=function(a,b){$('.pControl input',a).val(b.page);$('.pControl span',a).html(b.pages);var c=(b.page-1)*b.rp+1;var d=c+b.rp-1;if(b.total<d){d=b.total};var e=b.pagestat;e=e.replace(/{from}/,c);e=e.replace(/{to}/,d);e=e.replace(/{total}/,b.total);$('.pPageStat',a).html(e)};var E=function(b,c){$('.pPageStat',b).html(c.procmsg);$('.pReload',b).addClass('loading');var d={};if(c.usepager){d['pageNo']=c.page;d['pageSize']=c.rp;d['filter']=c.query}else{d=c.query};if(c.order){d['order']=c.sortname;d['is_desc']=(c.sortorder=="desc"?true:false)};b.data('sgDatagrid',c);$.ajax({type:"POST",async:false,contentType:"application/json",url:c.url,data:JSON.stringify(d),dataType:"json",success:function(a){if(c.usepager){if(a){c.total=a.total;c.page=a.index};F(a,b,c)}else{G(a,b,c)}}})};var F=function(r,s,t){$('.pReload',s).removeClass('loading');if(!r){$('.pPageStat',s).html(t.errormsg);return false};t.pages=Math.ceil(t.total/t.rp);D(s,t);var u=$('<tbody></tbody>');var w=$('.hDiv',s);$.each(r.items,function(i,o){var p=$('<tr></tr>');if(t.hiddenId){var q=$("<input type='hidden' id='"+t.hiddenId+"' name='"+t.hiddenId+"' />");q.val(o[t.hiddenId]);p.append(q)};$('thead tr:first th',w).each(function(){var a=$('<td></td>');var b=$(this).attr('editable');var c=$(this).attr('disabled');var d=$(this).attr('isnum');var e=$(this).attr('isrequest');var f=$(this).attr('axis');if(f=='checkbox'){var g=$('<input type="checkbox" style="margin-top:8px;" />');g.attr('axis',o[t.colid]);g.attr('name',s.attr("id")+"_chx");g.attr('value',o[t.colid]);g.data('data',o);a.append(g);g.change(function(){if(!g.attr("checked")){g.attr("checked","checked")}else if(g.attr("checked")){g.removeAttr("checked")}})}else if(f=='rownumbers'){var h=$(this).css('width');a.css('width',h);var j=$("#"+s.attr("id")+'_rp').val()*(t.page-1)+i+1;a.append(j)}else{var h=$(this).css('width');a.css('width',h);var l=$('<div></div>');l.css('padding-top','5px');l.css('line-height','16px');if(b){a.css('margin',0);a.css('padding',2);var m=$("<input type='text' />");m.attr('name',f);m.width(h);m.css('margin',0);m.css('padding',0);if(c){m.attr('disabled','disabled');m.val(o[f])};if(d){m.attr('type','number')};if(e){m.attr('required',e)};if(ishtml){$.each(t.colModel,function(k,v){if(v.name==f&&v.html!=null){l.html(v.html)}})}else{l.append(m)}}else{var n=false;$.each(t.colModel,function(k,v){if(v.name==f&&v.formatter!=null){n=true;l.html((v.formatter)(o[f],o))}});if(!n)l.html(o[f])};a.append(l)};p.append(a);a=null});u.append(p)});var x="#"+s.attr("id")+"_tbl";var y=$(x);$('tr',y).unbind();$(y).empty();y.append(u);$('tr:odd',y).addClass('normalRow');u=null;w=null;y=null;x=null;r=null};var G=function(s,t,u){var w=$('<tbody></tbody>');var x=$('.hDiv',t);$.each(s,function(i,p){var q=$('<tr></tr>');if(u.hiddenId){var r=$("<input type='hidden' id='"+u.hiddenId+"' name='"+u.hiddenId+"' />");r.val(p[u.hiddenId]);q.append(r)};$('thead tr:first th',x).each(function(){var a=$('<td></td>');var b=$(this).attr('editable');var c=$(this).attr('disabled');var d=$(this).attr('isnum');var e=$(this).attr('isrequest');var f=$(this).attr('ishtml');var g=$(this).attr('axis');if(g=='checkbox'){var h=$('<input type="checkbox" style="margin-top:8px;" />');h.attr('axis',p[u.colid]);h.attr('name',t.attr("id")+"_chx");h.attr('value',p[u.colid]);h.data('data',p);a.append(h);h.change(function(){if(!h.attr("checked")){h.attr("checked","checked")}else if(h.attr("checked")){h.removeAttr("checked")};if(u.chkChange){u.chkChange(i,p,h.attr("checked"))}})}else if(g=='rownumbers'){var j=$(this).css('width');a.css('width',j);var l=i+1;a.append(l)}else{var j=$(this).css('width');a.css('width',j);var m=$('<div></div>');m.css('padding-top','5px');m.css('line-height','16px');if(b){a.css('margin',0);a.css('padding',2);var n=$("<input type='text' />");n.attr('name',g);n.width(j);n.css('margin',0);n.css('padding',0);if(c){n.attr('disabled','disabled');n.val(p[g])};if(d){n.attr('type','number')};if(e){n.attr('required',e)};if(f){$.each(u.colModel,function(k,v){if(v.name==g&&v.html!=null){m.html(v.html)}})}else{m.append(n)}}else{var o=false;$.each(u.colModel,function(k,v){if(v.name==g&&v.formatter!=null){o=true;m.html((v.formatter)(p[g],p))}});if(!o)m.html(p[g])};a.append(m)};q.append(a);a=null});w.append(q)});var y="#"+t.attr("id")+"_tbl";var z=$(y);$('tr',z).unbind();$(z).empty();z.append(w);$('tr:odd',z).addClass('normalRow');w=null;x=null;z=null;y=null;s=null};var H=function(s,t,u){$('.pReload',t).removeClass('loading');if(!s){$('.pPageStat',t).html(u.errormsg);return false};u.pages=Math.ceil(u.total/u.rp);D(t,u);var w="#"+t.attr("id")+"_tbl";var x=$(w);$('tr',x).unbind();var y=$('tbody',x);if(!y.get(0)){y=$('<tbody></tbody>');x.append(y)};var z=$('.hDiv',t);$.each(s.items,function(i,p){var q=$('<tr></tr>');if(u.hiddenId){var r=$("<input type='hidden' id='"+u.hiddenId+"' name='"+u.hiddenId+"' />");r.val(p[u.hiddenId]);q.append(r)};$('thead tr:first th',z).each(function(){var a=$('<td></td>');var b=$(this).attr('editable');var c=$(this).attr('disabled');var d=$(this).attr('isnum');var e=$(this).attr('isrequest');var f=$(this).attr('ishtml');var g=$(this).attr('axis');if(g=='checkbox'){var h=$('<input type="checkbox" style="margin-top:8px;" />');h.attr('axis',p[u.colid]);h.attr('name',t.attr("id")+"_chx");h.attr('value',p[u.colid]);h.data('data',p);a.append(h);h.change(function(){if(!h.attr("checked")){h.attr("checked","checked")}else if(h.attr("checked")){h.removeAttr("checked")}})}else if(g=='rownumbers'){var j=$(this).css('width');a.css('width',j);var l=$("#"+t.attr("id")+'_rp').val()*(u.page-1)+i+1;a.append(l)}else{var j=$(this).css('width');a.css('width',j);var m=$('<div></div>');m.css('padding-top','5px');m.css('line-height','16px');if(b){a.css('margin',0);a.css('padding',2);var n=$("<input type='text' />");n.attr('name',g);n.width(j);n.css('margin',0);n.css('padding',0);if(c){n.attr('disabled','disabled');n.val(p[g])};if(d){n.attr('type','number')};if(e){n.attr('required',e)};if(f){$.each(u.colModel,function(k,v){if(v.name==g&&v.html!=null){m.html(v.html)}})}else{m.append(n)}}else{var o=false;$.each(u.colModel,function(k,v){if(v.name==g&&v.formatter!=null){o=true;m.html((v.formatter)(p[g],p))}});if(!o)m.html(p[g])};a.append(m)};q.append(a);a=null});y.append(q)});$('tr:odd',x).addClass('normalRow');y=null;z=null;x=null;w=null;s=null};var I=function(s,t,u){var w="#"+t.attr("id")+"_tbl";var x=$(w);$('tr',x).unbind();var y=$('tbody',x);if(!y.get(0)){y=$('<tbody></tbody>');x.append(y)};var z=$('.hDiv',t);$.each(s,function(i,p){var q=$('<tr></tr>');if(u.hiddenId){var r=$("<input type='hidden' id='"+u.hiddenId+"' name='"+u.hiddenId+"' />");r.val(p[u.hiddenId]);q.append(r)};$('thead tr:first th',z).each(function(){var a=$('<td></td>');var b=$(this).attr('editable');var c=$(this).attr('disabled');var d=$(this).attr('isnum');var e=$(this).attr('isrequest');var f=$(this).attr('ishtml');var g=$(this).attr('axis');if(g=='checkbox'){var h=$('<input type="checkbox" style="margin-top:8px;" />');h.attr('axis',p[u.colid]);h.attr('name',t.attr("id")+"_chx");h.attr('value',p[u.colid]);h.data('data',p);a.append(h);h.change(function(){if(!h.attr("checked")){h.attr("checked","checked")}else if(h.attr("checked")){h.removeAttr("checked")};if(u.chkChange){u.chkChange(i,p,h.attr("checked"))}})}else if(g=='rownumbers'){var j=$(this).css('width');a.css('width',j);var l=i+1;a.append(l)}else{var j=$(this).css('width');a.css('width',j);var m=$('<div></div>');m.css('padding-top','5px');m.css('line-height','16px');if(b){a.css('margin',0);a.css('padding',2);var n=$("<input type='text' />");n.attr('name',g);n.width(j);n.css('margin',0);n.css('padding',0);n.val(p[g]);if(c){n.attr('disabled','disabled')};if(d){n.attr('type','number')};if(e){n.attr('required',e)};if(f){$.each(u.colModel,function(k,v){if(v.name==g&&v.html!=null){m.html(v.html)}})}else{m.append(n)}}else{var o=false;$.each(u.colModel,function(k,v){if(v.name==g&&v.formatter!=null){o=true;m.html((v.formatter)(p[g],p))}});if(!o){m.html(p[g])}};a.append(m)};q.append(a);a=null});y.append(q)});$('tr:odd',x).addClass('normalRow');y=null;z=null;x=null;w=null;s=null};var J=function(a,b,c){c.newp=c.page;switch(a){case'first':c.newp=1;break;case'prev':if(c.page>1){c.newp=parseInt(c.page)-1};break;case'next':if(c.page<c.pages){c.newp=parseInt(c.page)+1};break;case'last':c.newp=c.pages;break;case'input':var d=parseInt($('.pControl input',b).val());if(isNaN(d)){d=1};if(d<1){d=1}else if(d>c.pages){d=c.pages};$('.pControl input',b).val(d);c.newp=d;break};if(c.newp==c.page){return false};c.page=c.newp;E(b,c)};var K=function(a,b,c){b.sortname=c.attr('axis');b.sortorder=c.attr("sort");E(a,b)};var L={init:function(d){return this.each(function(){var a=$(this);var b=a.data('sgDatagrid');if(typeof(b)=='undefined'){var c={title:false,width:600,height:240,url:'datagrid.json',exporturl:false,method:'POST',dataType:'json',errormsg:'连接出错！',usepager:false,page:1,total:1,pages:1,useRp:false,rp:10,rpOptions:[10,15,20,30,50],pagestat:'显示 {from} 到 {to} 条&nbsp;&nbsp;&nbsp;&nbsp;共 {total} 条纪录',procmsg:'正在读取数据……！',query:{},nomsg:'没有数据！',onChangeSort:false,onSuccess:false,onError:false,onSubmit:false,order:false,isNotCheckall:false};b=$.extend({},c,d);a.data('sgDatagrid',b)}else{b=$.extend({},b,d)};C(a,b)})},reload:function(a){var b=$(this).data('sgDatagrid');b=$.extend({},b,a);if(b.isFixed==false){}else{$(this).data('sgDatagrid',b)};E($(this),b)},destroy:function(b){return $(this).each(function(){var a=$(this);a.removeData('sgDatagrid');a.empty()})},val:function(a){var b=this.eq(0).html();return b},appendData:function(a){var b=$(this).data('sgDatagrid');if(b.isFixed==false){}else{$(this).data('sgDatagrid',b)};if(b.usepager){if(json){b.total=json.total;b.page=json.index};H(a,$(this),b)}else{I(a,$(this),b)}}};$.fn.sgDatagrid=function(){var a=arguments[0];if(L[a]){a=L[a];arguments=Array.prototype.slice.call(arguments,1)}else if(typeof(a)=='object'||!a){a=L.init}else{$.error('Method '+a+' does not exist on jQuery.sgDatagrid');return this};return a.apply(this,arguments)}})(jQuery);